digraph G {
    #http://www.graphviz.org/pdf/dotguide.pdf
    rankdir = RL

    pack=true;
    packmode="array_u";
    compound=true;


    Internet [ color = blue, style = filled ]

    "Monitoring subnet" [ color = green, style = filled ]
    "Logging subnet" [ color = red, style = filled ]
    "Management subnet" [ color = "chartreuse4", style = filled ]

    "Public VPC 1" [ color = "darkorchid1", style = filled ]
    "Public VPC 2" [ color = "darkorchid1", style = filled ]
    "Public VPC 3" [ color = "darkorchid1", style = filled ]

    "Private / VPN" [ color = "brown4", style = filled ]


    ranksep = 2.0
    nodesep = .5

    subgraph cluster_A
    {
        style="dashed"
        sortv=1;
    
        {
            rank = min;
            Internet;
        }
    }

    subgraph cluster_B
    {
        sortv=2;
        style="dashed"
    
        {
            rank = same;
            "Public VPC 1"; "Public VPC 2"; "Public VPC 3";
        }
    }



    subgraph cluster_C
    {
        sortv=3;
        "Management subnet" -> "Monitoring subnet" [ color="blue" ];
        "Management subnet" -> "Logging subnet" [ color="blue" ];
        style="dashed";
        label="Management VPC";

        {
            rank=same;
            "Monitoring subnet"; "Logging subnet"; "Management subnet";
        }
    }


    subgraph cluster_D
    {
        sortv=4;
        style="dashed"
        {
            rank = max;
            "Private / VPN"
        }
    }


#B1->A1 [constraint="false"];
#
#B1 -> A1
#[
#    ltail = "cluster_B"
#    lhead = "cluster_A"
#    style = "invis"
#]

#    Internet -> "Public VPC 1" [constraint="false"]
#    Internet -> "Public VPC 1"
    "Public VPC 1" -> Internet
    [
        ltail="cluster_B"
        lhead="cluster_A"
        style="dashed"
    ]

    Internet -> "Public VPC 1" [dir=both color="blue:darkorchid1"];
    Internet -> "Public VPC 2" [dir=both color="blue:darkorchid1"];
    Internet -> "Public VPC 3" [dir=both color="blue:darkorchid1"];

    "Public VPC 1" -> "Public VPC 2" [dir=both color="darkorchid1:darkorchid1"];
    "Public VPC 1" -> "Public VPC 3" [dir=both color="darkorchid1:darkorchid1"];
    "Public VPC 2" -> "Public VPC 3" [dir=both color="darkorchid1:darkorchid1"];


    "Private / VPN" -> "Monitoring subnet"
    "Private / VPN" -> "Logging subnet"
    "Private / VPN" -> "Management subnet"

    "Management subnet" -> "Public VPC 1"
    "Management subnet" -> "Public VPC 2"
    "Management subnet" -> "Public VPC 3"

    "Monitoring subnet" -> "Public VPC 1" [ color="green"];
    "Monitoring subnet" -> "Public VPC 2" [ color="green"];
    "Monitoring subnet" -> "Public VPC 3" [ color="green"];

    "Public VPC 1" -> "Logging subnet" [ color = "darkorchid1" ];
    "Public VPC 2" -> "Logging subnet" [ color = "darkorchid1" ];
    "Public VPC 3" -> "Logging subnet" [ color = "darkorchid1" ];
}
